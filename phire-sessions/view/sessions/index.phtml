<?php include $phireHeader; ?>
    <h1 class="sessions-header"><?=$title; ?></h1>
<?php if (count($sessions) > 0): ?>
<?php if (null !== $pages): ?>
    <div class="page-links"><?=$pages; ?></div>
<?php endif; ?>
<?php if ($acl->isAllowed($user->role, 'sessions', 'remove')): ?>
    <form id="sessions-form" action="<?=$phireUri . '/sessions/remove'; ?>" method="post">
<?php endif; ?>
        <table class="data-table" cellpadding="0" cellspacing="0" border="0">
            <tr>
                <th><a href="<?=$phireUri . '/sessions?sort=id';?>">#</a></th>
                <th><a href="<?=$phireUri . '/sessions?sort=username';?>">Username</a></th>
                <th>IP</th>
                <th>User Agent</th>
                <th><a href="<?=$phireUri . '/sessions?sort=start';?>">Start</a></th>
                <th class="text-center"><?php if ($acl->isAllowed($user->role, 'sessions', 'remove')): ?><input type="checkbox" name="checkall" id="checkall" value="rm_sessions" /><?php else: ?>&nbsp;<?php endif; ?></th>
            </tr>
<?php $i = 1; ?>
<?php
foreach ($sessions as $session):
    $ago = time() - $session->start;
    if ($ago < 60):
        $ago = '< 1 minute ago';
    elseif (($ago >= 60) && ($ago < 3600)):
        $minutes = round($ago / 60);
        $ago     = $minutes . ' minute' . (($minutes > 1) ? 's' : '') . ' ago';
    else:
        $hours = round($ago / 3600);
        $ago   = $hours . ' hour' . (($hours > 1) ? 's' : '') . ' ago';
    endif;
?>
            <tr>
                <td><?=$session->id; ?></td>
                <td><?=$session->username; ?></td>
                <td><?=$session->ip; ?></td>
                <td><?=$session->ua; ?></td>
                <td><?=date('M j Y H:i:s', $session->start); ?> [ <?=$ago; ?> ]</td>
                <td class="text-center"><?php if (($user->session->id != $session->id) && ($acl->isAllowed($user->role, 'sessions', 'remove'))): ?><input type="checkbox" name="rm_sessions[]" id="rm_sessions<?=$i++; ?>" value="<?=$session->id; ?>" /><?php else: ?>&nbsp;<?php endif; ?></td>
            </tr>
<?php endforeach; ?>
        </table>
<?php if ($acl->isAllowed($user->role, 'sessions', 'remove')): ?>
        <div id="form-footer"><input type="submit" name="submit" class="process-btn" value="Remove" /></div>
    </form>
<?php endif; ?>
<?php else: ?>
    <p>There are currently no sessions.</p>
<?php endif; ?>
<?php include $phireFooter; ?>